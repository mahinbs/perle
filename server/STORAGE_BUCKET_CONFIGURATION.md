# Supabase Storage Bucket Configuration

## Video Storage Bucket Size Limit

By default, Supabase Storage buckets have a 50MB file size limit. For video generation, you may need to increase this limit to 100MB or more.

### Option 1: Increase Bucket Limit via Dashboard (Recommended)

1. **Go to Supabase Dashboard**: https://app.supabase.com/project/YOUR_PROJECT_ID/storage/buckets
2. **Select your bucket**: Click on the `generated-media` bucket
3. **Click "Edit bucket"** in the top right
4. **Update File Size Limit**:
   - Change `Max file size` from `50 MB` to `100 MB` (or higher)
5. **Save Changes**

### Option 2: Increase via SQL

If you have superuser access, you can run this SQL:

```sql
-- Update bucket configuration to allow 100MB files
UPDATE storage.buckets
SET 
  file_size_limit = 104857600  -- 100MB in bytes
WHERE name = 'generated-media';
```

### Option 3: Create a Dedicated Video Bucket

Create a separate bucket specifically for videos with a higher limit:

1. **Create bucket** named `generated-videos`
2. **Set file size limit** to `100 MB` or `200 MB`
3. **Configure RLS policies** similar to `generated-media`:
   - Users can upload their own videos
   - Users can read their own videos
   - Users can delete their own videos
   - Public read access (optional)

### Current Video Generation

Currently, videos are generated by **Gemini Veo API** and returned as direct URLs from Google's servers. The videos are NOT uploaded to your Supabase storage, so the 50MB bucket limit does not apply to generated videos.

- **Video URLs**: Hosted by Google/Gemini
- **Video references**: Stored in `generated_media` table (just the URL)
- **No storage usage**: Videos don't count against your Supabase storage quota

### If You Want to Store Videos in Supabase

If you want to download and re-upload videos to your own Supabase storage:

1. **Increase bucket limit to 100MB+** (see above)
2. **Add video download/upload logic** in `server/src/utils/videoGeneration.ts`:

```typescript
// After video is generated by Gemini
async function uploadVideoToSupabase(videoUrl: string, userId: string): Promise<string> {
  // 1. Download video from Gemini URL
  const response = await fetch(videoUrl);
  const videoBuffer = await response.arrayBuffer();
  
  // 2. Optional: Compress video if > 50MB
  // Use ffmpeg or similar library
  
  // 3. Upload to Supabase
  const fileName = `${userId}-${Date.now()}.mp4`;
  const { data, error } = await supabase.storage
    .from('generated-videos')
    .upload(fileName, videoBuffer, {
      contentType: 'video/mp4',
      upsert: false
    });
  
  if (error) throw error;
  
  // 4. Get public URL
  const { data: urlData } = supabase.storage
    .from('generated-videos')
    .getPublicUrl(fileName);
  
  return urlData.publicUrl;
}
```

## Recommended Configuration

For the best user experience:

1. **Keep videos on Gemini's servers** (current setup)
   - No storage costs
   - Fast delivery via Google CDN
   - No file size management needed

2. **Increase `generated-media` bucket limit to 100MB** for future features
   - Allows user-uploaded videos
   - Allows optional video caching

3. **Monitor Gemini video quotas** instead:
   - Pro tier: 3 videos/day
   - Max tier: 6 videos/day
   - Adjust based on user feedback

## Video Compression (Future Enhancement)

If you decide to store videos in Supabase, consider adding video compression:

```bash
npm install fluent-ffmpeg @ffmpeg-installer/ffmpeg
```

```typescript
import ffmpeg from 'fluent-ffmpeg';
import ffmpegPath from '@ffmpeg-installer/ffmpeg';

ffmpeg.setFfmpegPath(ffmpegPath.path);

async function compressVideo(inputBuffer: Buffer, targetSizeMB: number = 49): Promise<Buffer> {
  // Compress video to target size
  // Implementation details...
}
```

## Current Status

‚úÖ **Videos are generated and returned from Gemini API**
‚úÖ **Download functionality works in Gallery**
‚úÖ **No Supabase storage limits apply to generated videos**
‚úÖ **Pro/Max tier quotas enforced**

üìù **Action Required**: If you want to store videos in Supabase, increase the bucket limit to 100MB via the Dashboard.

